# Worklog - Ngày 18/07/2025

## 📅 Thông tin cơ bản

- **Ngày**: 18/07/2025
- **Thứ**: Thứ Sáu
- **Tuần thực tập**: Tuần thứ 10
- **Thời gian làm việc**: 13:00 - 17:00
- **Mood**: 😐 Đã giải quyết được một lỗi, nhưng dữ liệu vẫn chưa đến OpenSearch, cần tìm hiểu thêm

## 🎯 Mục tiêu ngày hôm nay

- [x]  Mục tiêu 1: Tiếp tục debug và giải quyết vấn đề OpenSearch không nhận được dữ liệu từ Firehose
- [ ]  Mục tiêu 2: Kiểm tra xem dữ liệu có đến đích như dự định không (sẽ thực hiện sau khi dữ liệu được ingested)

## 💼 Công việc đã thực hiện

### 1. Debug và giải quyết vấn đề OpenSearch không nhận được dữ liệu từ Firehose ⏱️ 13:00 - 17:00

- **Mô tả**:
    - Tiếp tục rà soát CloudWatch Logs của Firehose Stream: Vẫn thấy lỗi ở đích đến (Destination errors).
    - Thực hiện mapping quyền cho IAM Role của Firehose trong Fine-grained access control (FGAC) của OpenSearch Dashboard:
        - Đăng nhập vào OpenSearch Dashboard qua Bastion Host
        - Điều hướng đến Security -> Role mappings
        - Mapping IAM Role của Kinesis Firehose
    - Kiểm tra lại Firehose CloudWatch metrics: Sau khi mapping quyền, Firehose CloudWatch metrics đã hết báo lỗi ở đích đến ("Destination delivery errors"). Điều này cho thấy vấn đề về quyền truy cập từ Firehose đến OpenSearch đã được giải quyết ở cấp độ OpenSearch FGAC.
    - Gửi dữ liệu thử nghiệm: Gửi lại các bản ghi mẫu vào Firehose Stream
    - Kiểm tra OpenSearch Dashboard: Dữ liệu vẫn chưa xuất hiện trong OpenSearch Dashboard. Mặc dù lỗi ở Firehose đã biến mất, OpenSearch vẫn không hiển thị bản ghi mới nào
- **Kết quả**: Vấn đề "Destination delivery errors" trong Firehose đã được khắc phục. Tuy nhiên, dữ liệu vẫn chưa được ingested vào OpenSearch, cho thấy có thể còn một nguyên nhân khác
- **Tools/Tech**:
    - AWS Kinesis Firehose
    - AWS OpenSearch Dashboard
- **Links**: [GitHub commits, documentation, screenshots]

## 📚 Kiến thức học được

### 🔧 Technical Skills

- **AWS Services**: Nắm vững hơn về cơ chế Fine-grained access control (FGAC) trong Amazon OpenSearch Service và tầm quan trọng của việc mapping IAM Roles với các vai trò nội bộ của OpenSearch để cấp quyền truy cập dữ liệu. Cải thiện kỹ năng đọc và phân tích CloudWatch Logs để xác định trạng thái giao tiếp giữa các dịch vụ.
- **DevOps**: Thực hành kỹ năng End-to-end troubleshooting trong một pipeline dữ liệu, đặc biệt khi vấn đề chuyển từ lớp mạng/quyền sang lớp dữ liệu/cấu trúc.
- **Architecture**: Hiểu sâu hơn về các lớp bảo mật và cách chúng ảnh hưởng đến luồng dữ liệu giữa các dịch vụ.

### 💡 Concepts & Theory

- **New Concepts**:
    - Vai trò cụ thể của Role mapping trong OpenSearch FGAC để cho phép các dịch vụ AWS ghi dữ liệu.
    - Sự khác biệt giữa lỗi kết nối/quyền (Firehose báo lỗi) và lỗi ingestion/parsing (OpenSearch không hiển thị dữ liệu).
- **Best Practices**:
    - Chia nhỏ vấn đề: Khi debug, hãy cố gắng giải quyết từng lớp lỗi một (ví dụ: network -> IAM -> FGAC -> data format/indexing).
    - Kiểm tra CloudWatch metrics của cả nguồn và đích: Để có cái nhìn toàn diện về luồng dữ liệu và xác định nơi gián đoạn.
- **Industry Knowledge**: Quy trình chuẩn trong việc xử lý sự cố trong các hệ thống phân tán, nơi các lỗi có thể "ẩn mình" ở nhiều tầng khác nhau.

### 🤝 Soft Skills

- **Problem Solving**: Đã xác định và giải quyết thành công một lớp vấn đề (FGAC), thu hẹp phạm vi tìm kiếm nguyên nhân.
- **Learning**: Tích cực tìm kiếm thông tin về lý do tại sao Firehose không báo lỗi nhưng dữ liệu vẫn chưa đến đích.
- **Resilience**: Duy trì sự kiên nhẫn khi vấn đề vẫn còn sau khi áp dụng một giải pháp

## 🚧 Khó khăn và giải pháp

### Vấn đề 1: **OpenSearch không nhận được log từ Firehose gửi đến**

- **Mô tả**: Sau khi tạo Firehose Stream và thấy dữ liệu backup thành công vào S3, nhưng OpenSearch Dashboard vẫn không hiển thị dữ liệu mới. Ban đầu, Firehose CloudWatch metrics báo lỗi ở đích đến.
- **Impact**: Toàn bộ luồng dữ liệu log bị gián đoạn, không thể kiểm tra hoặc phân tích dữ liệu.
- **Root Cause**: Đã phát hiện và khắc phục được nguyên nhân đầu tiên là thiếu mapping cho IAM Role của Firehose trong Fine-grained access control (FGAC) của OpenSearch Dashboard.
- **Solution**: Đã đăng nhập vào OpenSearch Dashboard qua Bastion và thực hiện mapping quyền cần thiết cho IAM Role của Firehose
- **Result**: Sau khi mapping quyền, Firehose CloudWatch metrics đã hết báo lỗi ở đích đến. Tuy nhiên, OpenSearch vẫn không nhận được dữ liệu thực tế. Điều này chỉ ra rằng vấn đề đã chuyển từ lỗi quyền truy cập mạng/service sang một vấn đề khác liên quan đến cách OpenSearch xử lý dữ liệu được gửi đến (ví dụ: định dạng dữ liệu, Index Template, mapping).
- **Lesson**: Việc giải quyết một lỗi không đồng nghĩa với việc toàn bộ hệ thống sẽ hoạt động trơn tru. Cần tiếp tục debug và tìm kiếm nguyên nhân ở các lớp sâu hơn khi một lỗi được khắc phục mà vấn đề tổng thể vẫn còn

## 💭 Reflection & Insights

### What went well today?

- Khắc phục được lỗi "Destination delivery errors" trong Firehose, điều này cho thấy quyền truy cập cấp cao đã được thiết lập đúng.
- Học được cách cấu hình Role mapping trong OpenSearch FGAC, một kiến thức quan trọng khi tích hợp các dịch vụ AWS.
- Kiên trì trong việc debugging và không bỏ cuộc khi thấy vấn đề vẫn còn.

### What could be improved?

- Tìm hiểu kỹ hơn về các yêu cầu định dạng dữ liệu và Index Templates của OpenSearch trước khi gửi dữ liệu, để tránh phát sinh vấn đề này.
- Đọc log chi tiết hơn từ phía OpenSearch ngay khi Firehose hết lỗi, thay vì chỉ kiểm tra Dashboard.

### Key Insights

- FGAC là lớp bảo mật quan trọng của OpenSearch: Nó kiểm soát quyền truy cập dữ liệu bên trong domain, và cần được cấu hình đúng cho các dịch vụ gửi dữ liệu.
- Các lỗi có thể là "chuỗi": Giải quyết một lỗi có thể dẫn đến việc phát hiện lỗi khác ở tầng sâu hơn.
- Định dạng dữ liệu rất quan trọng: Ngay cả khi quyền đã đủ, dữ liệu không đúng định dạng vẫn sẽ bị OpenSearch từ chối.

### Questions & Curiosities

- Làm thế nào để xem log nội bộ của OpenSearch Service (ví dụ: log về lỗi parsing, mapping) để biết chính xác lý do nó không ingest dữ liệu?
- Cấu hình Index Template trong Firehose có thực sự cần thiết, hay có thể tạo Template trực tiếp trong OpenSearch Dashboard?
- Có công cụ hoặc cách nào để validate định dạng dữ liệu JSON trước khi gửi vào Firehose để đảm bảo nó tương thích với OpenSearch không?

## 📋 Kế hoạch ngày mai

### Priority Tasks

- [ ]  **High**: Tìm hiểu các nguyên nhân khác khiến dữ liệu không đến được đích
- [ ]  **High:** Tìm cách khắc phục vấn đề

### Learning Goals

- [ ]  Nắm vững cách đọc log từ OpenSearch Service qua CloudWatch Logs.
- [ ]  Hiểu rõ về OpenSearch Index Templates và Data Mappings.
- [ ]  Tìm hiểu cách debug các vấn đề về định dạng dữ liệu trong OpenSearch.

### Meetings & Deadlines

- [ ]  Hoàn thành project trước ngày 20/07

## 📊 Self Assessment

### Productivity

- **Score**: [6/10]
- **Reason**: Đã giải quyết được một vấn đề quan trọng (lỗi Firehose), nhưng vẫn chưa đạt được mục tiêu cuối cùng là dữ liệu đến OpenSearch
- **Improvement**: Cần tập trung hơn vào việc đọc log và tìm hiểu sâu về yêu cầu của OpenSearch

### Learning

- **Score**: [8/10]
- **New Knowledge**: Hiểu sâu hơn về FGAC và các lớp lỗi trong pipeline dữ liệu
- **Application**: Vận dụng kỹ năng debugging vào một tình huống thực tế, phức tạp

### Collaboration

- **Score**: [7/10]
- **Interactions**: Đã chuẩn bị sẵn sàng các chi tiết vấn đề để thảo luận với mentor vào ngày mai
- **Contributions**: Đã loại trừ được một nguyên nhân lỗi, thu hẹp phạm vi tìm kiếm

### Overall Satisfaction

- **Score**: [6/10]
- **Highlights**: Đã vượt qua được một lỗi phức tạp và có cái nhìn rõ ràng hơn về bước tiếp theo
- **Areas for Growth**: Cần cải thiện kỹ năng giải quyết các vấn đề liên quan đến định dạng dữ liệu và cấu hình service-level của OpenSearch

---

**📝 Notes for tomorrow:**
[Ghi chú quan trọng cho ngày mai]

**🎯 Week Progress:** Day 5/5 completed.

---

*Worklog created by: Trương Đình Vũ Khanh*

*Next review: 21/07/2025*