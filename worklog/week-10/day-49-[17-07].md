# Worklog - Ngày 17/07/2025

## 📅 Thông tin cơ bản

- **Ngày**: 17/07/2025
- **Thứ**: Thứ Năm
- **Tuần thực tập**: Tuần thứ 10
- **Thời gian làm việc**: 8:00 - 17:00
- **Mood**: 😐 Tuy đã hoàn thành việc thiết lập Firehose, nhưng dữ liệu vẫn chưa đến được OpenSearch, cần thêm thời gian để debug

## 🎯 Mục tiêu ngày hôm nay

- [x]  Mục tiêu 1: Thiết lập Kinesis Firehose Stream với Destination là OpenSearch và backup vào S3 Bucket
- [x]  Mục tiêu 2: Kiểm tra xem dữ liệu có đến đích như dự định không

## 💼 Công việc đã thực hiện

### 1. Thiết lập Kinesis Firehose Stream với Destination là OpenSearch và backup vào S3 Bucket ⏱️ 8:00 - 13:00

- **Mô tả**:
    - Tạo một IAM Role mới cho Kinesis Firehose với các quyền cần thiết để đọc từ nguồn (Direct Put), ghi vào OpenSearch Service domain và ghi vào S3 Bucket đã tạo trước đó. Đặc biệt, đã thêm các quyền liên quan đến VPC để Firehose có thể truy cập OpenSearch trong VPC.
    - Tạo một Kinesis Firehose Stream mới thông qua AWS Console.
    - Cấu hình nguồn (Source) là "Direct Put" để có thể gửi dữ liệu trực tiếp vào Firehose.
    - Chọn đích đến (Destination) là Amazon OpenSearch Service, trỏ đến domain
    - Cấu hình bật tính năng backup vào S3 Bucket để lưu trữ lâu dài.
- **Kết quả**: Kinesis Firehose Stream đã được tạo thành công, và cấu hình để đẩy dữ liệu tới OpenSearch đồng thời backup vào S3
- **Tools/Tech**:
    - AWS Kinesis Firehose
    - AWS IAM
    - AWS S3
    - AWS OpenSearch Service
- **Links**: [GitHub commits, documentation, screenshots]

### 2. Kiểm tra xem dữ liệu có đến đích như dự định không ⏱️ 13:00 - 17:00

- **Mô tả**:
    - Gửi dữ liệu thử nghiệm vào Firehose Stream
    - Kiểm tra S3 bucket: Xác minh rằng các bản ghi được backup đã xuất hiện trong S3 theo cấu hình
    - Kiểm tra OpenSearch Dashboard: Truy cập Dashboard thông qua Bastion để xem dữ liệu có được ingested vào OpenSearch index không
    - Kiểm tra biểu đồ và log lỗi trong Firehose Stream metrics (Amazon CloudWatch) để xác định trạng thái gửi dữ liệu đến đích
- **Kết quả**:
    - Dữ liệu backup vào S3 bucket thành công. Các file log xuất hiện trong thư mục được cấu hình
    - Tuy nhiên, OpenSearch Dashboard vẫn không hiển thị dữ liệu mới. Biểu đồ trong Firehose vẫn báo lỗi và số lượng bản ghi đến đích OpenSearch là 0
- **Tools/Tech**:
    - AWS Kinesis Firehose
    - AWS S3
    - AWS OpenSearch Dashboard
- **Links**: [GitHub commits, documentation, screenshots]

## 📚 Kiến thức học được

### 🔧 Technical Skills

- **AWS Services**: Thực hành cấu hình **Kinesis Firehose** end-to-end, bao gồm việc tạo IAM Role, chọn nguồn và đích, cũng như cấu hình backup
- **DevOps**: Tìm hiểu về các vấn đề phổ biến khi tích hợp các dịch vụ AWS với nhau (quyền IAM, cấu hình network)
- **Architecture**: Hiểu về luồng dữ liệu trong một hệ thống logging đơn giản: Data Source -> Kinesis Firehose -> OpenSearch / S3

### 💡 Concepts & Theory

- **New Concepts**:
    - IAM permissions chi tiết cần thiết cho Firehose để tương tác với OpenSearch trong VPC
    - Destination errors trong Firehose
- **Best Practices**:
    - Luôn kiểm tra IAM Role của dịch vụ khi gặp lỗi "permission denied" hoặc "access denied" giữa các dịch vụ
    - Sử dụng tính năng backup của Firehose để đảm bảo không mất dữ liệu ngay cả khi đích chính gặp sự cố
- **Industry Knowledge**: Tầm quan trọng của một giải pháp thu thập và lưu trữ log tập trung trong các hệ thống hiện đại để phục vụ observability

### 🤝 Soft Skills

- **Problem Solving**: Đã phát hiện và giải quyết được vấn đề về quyền IAM Role của Firehose. Đang tiếp tục debug vấn đề Firehose không gửi được dữ liệu đến OpenSearch
- **Learning**: Tích cực tìm kiếm thông tin về các lỗi Firehose, đặc biệt là lỗi liên quan đến đích OpenSearch trong VPC
- **Time Management**: Đã hoàn thành các mục tiêu chính của ngày, mặc dù có phát sinh vấn đề cần debug thêm

## 🚧 Khó khăn và giải pháp

### Vấn đề 1: Lỗi khi tạo Firehose Stream

- **Mô tả**: Khi cố gắng tạo Firehose Stream, gặp lỗi cho biết IAM Role của Firehose không có đủ quyền để tương tác với các tài nguyên đích, đặc biệt là OpenSearch trong VPC.
- **Impact**: Không thể tạo được Firehose Stream, ngăn cản việc tiến hành các bước tiếp theo
- **Root Cause**: IAM Role của Firehose thiếu các quyền cần thiết để tạo và quản lý Network Interface (ENI) trong VPC của OpenSearch. Do OpenSearch Domain được tạo trong VPC, Firehose cần một số quyền `ec2:` để thiết lập kết nối mạng nội bộ
- **Solution**: Đã bổ sung các quyền sau vào IAM Policy của Firehose Role:
    - `ec2:DescribeVpcs`
    - `ec2:DescribeSubnets`
    - `ec2:DescribeSecurityGroups`
    - `ec2:CreateNetworkInterface`
    - `ec2:DeleteNetworkInterface`
    - `ec2:DescribeNetworkInterfaces`
- **Result**: Đã tạo thành công Firehose Stream sau khi thêm các quyền này
- **Lesson**: Khi tích hợp các dịch vụ AWS có liên quan đến VPC, hãy luôn nhớ kiểm tra và cấp quyền `ec2:` cần thiết cho các dịch vụ để chúng có thể quản lý giao diện mạng

### Vấn đề 2: OpenSearch không nhận được log từ Firehose gửi đến

- **Mô tả**:
    - Xuất hiện lỗi destination trong Firehose Stream
    - OpenSearch Domain không nhận được dữ liệu từ Firehose
- **Impact**: Luồng dữ liệu log bị gián đoạn, không thể kiểm tra hoặc phân tích dữ liệu
- **Root Cause**: Chưa tìm được nguyên nhân chính xác
- **Solution**: Chưa tìm được cách giải quyết hoàn chỉnh
- **Result**: Vấn đề vẫn còn tồn tại. Firehose chưa gửi được dữ liệu đến OpenSearch
- **Lesson**: Debug các vấn đề tích hợp dịch vụ phức tạp cần sự kiên nhẫn và hệ thống. Đôi khi, việc giải quyết một lỗi chỉ là mở ra một lỗi khác ở lớp sâu hơn

## 💭 Reflection & Insights

### What went well today?

- Hoàn thành việc cấu hình Firehose Stream và hiểu rõ các bước liên quan.
- Giải quyết thành công vấn đề quyền IAM phức tạp cho Firehose khi tương tác với VPC.
- Xác nhận được dữ liệu backup thành công vào S3, đảm bảo tính toàn vẹn dữ liệu.

### What could be improved?

- Hiểu sâu hơn về định dạng dữ liệu mà OpenSearch mong muốn từ Firehose để tránh các vấn đề về phân tích/ingest.
- Cần kiểm tra kỹ các log chi tiết hơn từ OpenSearch để xem nó có báo lỗi gì khi nhận dữ liệu từ Firehose không.
- Phân bổ thời gian debugging hợp lý hơn để không bị cuốn vào một vấn đề quá lâu.

### Key Insights

- IAM permissions là một thách thức lớn: Việc cấu hình đúng quyền giữa các dịch vụ AWS, đặc biệt khi có VPC xen vào, đòi hỏi sự hiểu biết rất sâu sắc và tỉ mỉ.
- OpenSearch Service có nhiều lớp bảo mật: Ngoài IAM và Domain Policies, Fine-grained access control là một lớp quan trọng khác cần được cấu hình đúng để dữ liệu được ingested.
- S3 là một giải pháp backup đáng tin cậy: Rất dễ dàng để cấu hình Firehose backup dữ liệu vào S3, cung cấp một lưới an toàn cho dữ liệu log.

### Questions & Curiosities

- Làm thế nào để xem log chi tiết hơn từ OpenSearch về các bản ghi bị từ chối/lỗi khi ingested?
- Liệu có cần cấu hình một Lambda Transformation trong Firehose để định dạng lại dữ liệu trước khi gửi tới OpenSearch không?

## 📋 Kế hoạch ngày mai

### Priority Tasks

- [ ]  **High**: Debug vấn đề OpenSearch không nhận được dữ liệu từ Firehose

### Learning Goals

- [ ]  Nghiên cứu cách OpenSearch Service xử lý các loại dữ liệu và yêu cầu về cấu trúc dữ liệu khi ingested từ Firehose
- [ ]  Tìm hiểu cấu hình các quyền cần thiết để Firehose gửi được log đến OpenSearch

### Meetings & Deadlines

- [ ]  Hoàn thành project trước ngày 20

## 📊 Self Assessment

### Productivity

- **Score**: [7/10]
- **Reason**: Đã hoàn thành mục tiêu cấu hình, nhưng vấn đề về ingestion dữ liệu đã cản trở việc hoàn tất hoàn toàn
- **Improvement**: Cần tập trung hơn vào việc debug và không để mất quá nhiều thời gian vào các lỗi nhỏ

### Learning

- **Score**: [8/10]
- **New Knowledge**: Hiểu sâu hơn về các lớp quyền của Firehose và OpenSearch, cũng như quá trình debugging hệ thống dữ liệu
- **Application**: Vận dụng các kiến thức về IAM, VPC và cấu hình dịch vụ AWS để giải quyết vấn đề thực tế

### Overall Satisfaction

- **Score**: [6/10]
- **Highlights**: Đã giải quyết được một vấn đề quyền phức tạp khác và có cái nhìn rõ ràng hơn về bước tiếp theo
- **Areas for Growth**: Cần cải thiện kỹ năng debug các vấn đề liên quan đến format dữ liệu và cấu hình service-level của OpenSearch

---

**📝 Notes for tomorrow:**
[Ghi chú quan trọng cho ngày mai]

**🎯 Week Progress:** Day 4/5 completed.

---

*Worklog created by: Trương Đình Vũ Khanh*

*Next review: 18/07/2025*